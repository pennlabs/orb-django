description: >
  Set up the CI environment

parameters:
  project-location:
    description: Location of the django project. Defaults to .
    type: string
    default: "."

steps:
  - restore_cache:
      key: v0-{{ .Branch }}-{{ checksum "<< parameters.project-location >>/Pipfile.lock" }}
  - run:
      name: Install dependencies
      command: |
        cd << parameters.project-location >>
        sudo pip install pipenv
        pipenv install --deploy --dev
  - save_cache:
      key: v0-{{ .Branch }}-{{ checksum "<< parameters.project-location >>/Pipfile.lock" }}
      paths:
        - "<< parameters.project-location >>/.venv"
        - "/usr/local/bin"
        - "/usr/local/lib/python3.7/site-packages"
